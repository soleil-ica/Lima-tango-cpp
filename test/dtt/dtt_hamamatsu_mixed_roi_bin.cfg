#############################################################
# fichier de config pour tests de la propriété ExpertAllowMixedRoiBinning avec les cameras Hamamatsu
# date : 17/11/2025
#############################################################
#
@------------------------
@Change device proxy to hamamatsu/test/orca1
@------------------------
SET_PROXY;hamamatsu/test/orca1;;;;;
#
@------------------------------------
@Prepare all Hamamatsu-generic properties for tests
@------------------------------------
WRITE_PROP;AutoSaveResetRoi;BOOL;[true];;;;
WRITE_PROP;AutoStartVideo;BOOL;[false];;;;
WRITE_PROP;DebugFormats;STR_A;[DateTime,Type,Funct];;;;
WRITE_PROP;DebugLevels;STR_A;[Fatal,Error,Warning,Trace];;;;
WRITE_PROP;DebugModules;STR;[Camera];;;;
WRITE_PROP;DetectorDescription;STR;[Hamamatsu @ Labo Detecteurs];;;;
WRITE_PROP;DetectorPixelDepth;INT;[16];;;;
WRITE_PROP;DetectorType;STR;[Hamamatsu];;;;
WRITE_PROP;DetectorVideoMode;STR;[NONE];;;;
WRITE_PROP;ExpertBufferMaxMem;INT;[10];;;;
WRITE_PROP;ExpertNbPoolThread;INT;[8];;;;
WRITE_PROP;ExpertTimeoutCmd;INT;[5000];;;;
WRITE_PROP;ExpertUsePrepareCmd;BOOL;[true];;;;
WRITE_PROP;ExpertAllowMixedRoiBinning;BOOL;[true];;;;
WRITE_PROP;FileFormat;STR;[NXS];;;;
WRITE_PROP;FileIndexPattern;STR;[%08d];;;;
WRITE_PROP;FileManagedMode;STR;[SOFTWARE];;;;
WRITE_PROP;FileMemoryMode;STR;[NO_COPY];;;;
WRITE_PROP;FileNbFrames;INT;[1];;;;
WRITE_PROP;FilePrefix;STR;[Image];;;;
WRITE_PROP;FileTargetPath;STR;[D:\TestDevice];;;;
WRITE_PROP;FileTimestampEnabled;BOOL;[true];;;;
WRITE_PROP;FileWriteMode;STR;[SYNCHRONOUS];;;;
WRITE_PROP;ImageOpMode;STR;[SoftOnly];;;;
WRITE_PROP;ImageSource;STR;[VIDEO];;;;
WRITE_PROP;MemorizedAcquisitionMode;STR;[SINGLE];;;;
WRITE_PROP;MemorizedBinningH;INT;[1];;;;
WRITE_PROP;MemorizedBinningV;INT;[1];;;;
WRITE_PROP;MemorizedExposureAccTime;INT;[1000];;;;
WRITE_PROP;MemorizedExposureTime;INT;[1000];;;;
WRITE_PROP;MemorizedFileGeneration;BOOL;[false];;;;
WRITE_PROP;MemorizedLatencyTime;INT;[0];;;;
WRITE_PROP;MemorizedNbFrames;INT;[5];;;;
WRITE_PROP;MemorizedRoi;STR_A;[0,0,0,0];;;;
WRITE_PROP;MemorizedShutterCloseTime;INT;[1000];;;;
WRITE_PROP;MemorizedShutterMode;STR;[MANUAL];;;;
WRITE_PROP;MemorizedShutterOpenTime;INT;[1000];;;;
WRITE_PROP;MemorizedTriggerMode;STR;[INTERNAL_MULTI];;;;
WRITE_PROP;SpoolID;STR;[TO_BE_DEFINED];;;;
#
@------------------------
@Change device proxy to hamamatsu/test/orca1-specific
@------------------------
SET_PROXY;hamamatsu/test/orca1-specific;;;;;
#
@------------------------------------
@Prepare all Hamamatsu-specific properties for tests
@------------------------------------
WRITE_PROP;bottomViewExposureTime;INT;[1000];;;;
WRITE_PROP;topViewExposureTime;INT;[1000];;;;
WRITE_PROP;readoutSpeed;STR;[STANDARD];;;;
WRITE_PROP;sensorMode;STR;[AREA];;;;
WRITE_PROP;wViewEnabled;BOOL;[false];;;;
#
@------------------------
@Change device proxy to hamamatsu/test/orca1
@------------------------
SET_PROXY;hamamatsu/test/orca1;;;;;
#
@----------------------------------------
@Reset Roi
@----------------------------------------
CMD;ResetROI;;;;;
#
@----------------------------------------
@Reset binning
@----------------------------------------
CMD;ResetBinning;;;;;
#
@--------------------------------------
@Sleep 2 sec (Execute a system command)
@--------------------------------------
EXEC;sleep;REAL;2;;;
#
@---------------------------------------------------------------------------------------
@---------------------------------------------------------------------------------------
@ PART I - Set binning and ROI with ExpertAllowMixedRoiBinning = true
@---------------------------------------------------------------------------------------
@---------------------------------------------------------------------------------------
#
@------------------------
@Change device proxy to hamamatsu/test/orca1
@------------------------
SET_PROXY;hamamatsu/test/orca1;;;;;
#
@------------------------
@Init device 
@------------------------
CMD;Init;;;KO;;
#
@------------------------
@Wait (while state is UNKNOWN due to Init)
@------------------------
WAIT;state;STATE;8;DIFF;UNKNOWN;
#
@------------------------
@Wait (while state is INIT due to Init)
@------------------------
WAIT;state;STATE;0.2;DIFF;INIT;
#
@----------------------------------------
@Set binning
@----------------------------------------
CMD;SetBinning;INT;2,2;;;
#
@------------------------------------------------------
@Check x - y - width - height attributes
@------------------------------------------------------
READ;binningH;INT;;EQUAL;2;
READ;binningV;INT;;EQUAL;2;
#
@---------------------------------------------------------------
@Set nbFrames (1) - triggerMode (INTERNAL_SINGLE) - exposureTime (2.0)
@--------------------------------------------------------------
WRITE;nbFrames;INT;1;;;
WRITE;triggerMode;STR;INTERNAL_SINGLE;;;
WRITE;exposureTime;REAL;1000.0;;;
#
@------------------------------------------------------
@Check nbFrames - triggerMode - triggerMode attributes
@------------------------------------------------------
READ;nbFrames;INT;;EQUAL;1;
READ;exposureTime;REAL;;EQUAL;1000.0;
READ;triggerMode;STR;;EQUAL;INTERNAL_SINGLE;
#
@----------------------------------
@Prepare
@----------------------------------
CMD;Prepare;;;;;
#
@----------------------------------
@Snap with triggerMode = INTERNAL_SINGLE
@----------------------------------
CMD;Snap;;;;;
#
@-------------------------------
@Wait (while state is STANDBY)
@-------------------------------
WAIT;state;STATE;0.1;DIFF;STANDBY;
#
@---------------------------------------------------
@Check State is RUNNING when Capture is in progress
@---------------------------------------------------
READ;state;STATE;;EQUAL;RUNNING;
#
@------------------------
@Wait (while state is RUNNING due to Snap)
@------------------------
WAIT;state;STATE;0.1;DIFF;RUNNING;
#
@---------------------------------------------------
@Check State is STANDBY at the end of Snap
@---------------------------------------------------
READ;state;STATE;;EQUAL;STANDBY;
#
@--------------------------------------
@Sleep 2 sec (Execute a system command)
@--------------------------------------
EXEC;sleep;REAL;2;;;
#
@----------------------------------------
@Set Roi
@----------------------------------------
CMD;SetRoi;INT;256,256,42,42;;;
#
@------------------------------------------------------
@Check x - y - width - height attributes
@------------------------------------------------------
READ;roiX;INT;;EQUAL;256;
READ;roiY;INT;;EQUAL;256;
READ;roiWidth;INT;;EQUAL;42;
READ;roiHeight;INT;;EQUAL;42;
#
@---------------------------------------------------------------
@Set nbFrames (1) - triggerMode (INTERNAL_SINGLE) - exposureTime (2.0)
@--------------------------------------------------------------
WRITE;nbFrames;INT;1;;;
WRITE;triggerMode;STR;INTERNAL_SINGLE;;;
WRITE;exposureTime;REAL;1000.0;;;
#
@------------------------------------------------------
@Check nbFrames - triggerMode - triggerMode attributes
@------------------------------------------------------
READ;nbFrames;INT;;EQUAL;1;
READ;exposureTime;REAL;;EQUAL;1000.0;
READ;triggerMode;STR;;EQUAL;INTERNAL_SINGLE;
#
@----------------------------------
@Prepare
@----------------------------------
CMD;Prepare;;;;;
#
@----------------------------------
@Snap with triggerMode = INTERNAL_SINGLE
@----------------------------------
CMD;Snap;;;;;
#
@-------------------------------
@Wait (while state is STANDBY)
@-------------------------------
WAIT;state;STATE;0.1;DIFF;STANDBY;
#
@---------------------------------------------------
@Check State is RUNNING when Capture is in progress
@---------------------------------------------------
READ;state;STATE;;EQUAL;RUNNING;
#
@------------------------
@Wait (while state is RUNNING due to Snap)
@------------------------
WAIT;state;STATE;0.1;DIFF;RUNNING;
#
@---------------------------------------------------
@Check State is STANDBY at the end of Snap
@---------------------------------------------------
READ;state;STATE;;EQUAL;STANDBY;
#
@--------------------------------------
@Sleep 2 sec (Execute a system command)
@--------------------------------------
EXEC;sleep;REAL;2;;;
#
@---------------------------------------------------------------------------------------
@---------------------------------------------------------------------------------------
@ PART II - Check that device init fails if binning and ROI is set with ExpertAllowMixedRoiBinning = false
@---------------------------------------------------------------------------------------
@---------------------------------------------------------------------------------------
#
@------------------------
@Change device proxy to hamamatsu/test/orca1
@------------------------
SET_PROXY;hamamatsu/test/orca1;;;;;
#
@----------------------------------------
@Set ExpertAllowMixedRoiBinning to false
@----------------------------------------
WRITE_PROP;ExpertAllowMixedRoiBinning;BOOL;[false];;;;
#
@------------------------
@Init device 
@------------------------
CMD;Init;;;KO;;
#
@------------------------
@Wait (while state is UNKNOWN due to Init)
@------------------------
WAIT;state;STATE;8;DIFF;UNKNOWN;
#
@------------------------
@Wait (while state is INIT due to Init)
@------------------------
WAIT;state;STATE;0.2;DIFF;INIT;
#
@---------------------------------------------------
@Check State is FAULT
@---------------------------------------------------
READ;state;STATE;;EQUAL;FAULT;
#
@----------------------------------------
@Set ExpertAllowMixedRoiBinning to false to reset device
@----------------------------------------
WRITE_PROP;ExpertAllowMixedRoiBinning;BOOL;[true];;;;
#
@------------------------
@Init device 
@------------------------
CMD;Init;;;KO;;
#
@------------------------
@Wait (while state is UNKNOWN due to Init)
@------------------------
WAIT;state;STATE;8;DIFF;UNKNOWN;
#
@------------------------
@Wait (while state is INIT due to Init)
@------------------------
WAIT;state;STATE;0.2;DIFF;INIT;
#
@----------------------------------------
@Reset Roi
@----------------------------------------
CMD;ResetROI;;;;;
#
@----------------------------------------
@Reset binning
@----------------------------------------
CMD;ResetBinning;;;;;
#
@--------------------------------------
@Sleep 2 sec (Execute a system command)
@--------------------------------------
EXEC;sleep;REAL;2;;;
#
@---------------------------------------------------------------------------------------
@---------------------------------------------------------------------------------------
@ PART III - Set binning then ROI with ExpertAllowMixedRoiBinning = false
@---------------------------------------------------------------------------------------
@---------------------------------------------------------------------------------------
#
@------------------------
@Change device proxy to hamamatsu/test/orca1
@------------------------
SET_PROXY;hamamatsu/test/orca1;;;;;
#
@----------------------------------------
@Set ExpertAllowMixedRoiBinning to false
@----------------------------------------
WRITE_PROP;ExpertAllowMixedRoiBinning;BOOL;[false];;;;
#
@------------------------
@Init device 
@------------------------
CMD;Init;;;KO;;
#
@------------------------
@Wait (while state is UNKNOWN due to Init)
@------------------------
WAIT;state;STATE;8;DIFF;UNKNOWN;
#
@------------------------
@Wait (while state is INIT due to Init)
@------------------------
WAIT;state;STATE;0.2;DIFF;INIT;
#
@----------------------------------------
@Set binning
@----------------------------------------
CMD;SetBinning;INT;2,2;;;
#
@------------------------------------------------------
@Check x - y - width - height attributes
@------------------------------------------------------
READ;binningH;INT;;EQUAL;2;
READ;binningV;INT;;EQUAL;2;
#
@--------------------------------------
@Sleep 2 sec (Execute a system command)
@--------------------------------------
EXEC;sleep;REAL;2;;;
#
@----------------------------------------
@Set Roi
@----------------------------------------
CMD;SetRoi;INT;256,256,42,42;KO;;
#
@----------------------------------------
@Reset Roi
@----------------------------------------
CMD;ResetROI;;;;;
#
@----------------------------------------
@Reset binning
@----------------------------------------
CMD;ResetBinning;;;;;
#
@---------------------------------------------------------------------------------------
@---------------------------------------------------------------------------------------
@ PART IV - Set ROI then binning with ExpertAllowMixedRoiBinning = false
@---------------------------------------------------------------------------------------
@---------------------------------------------------------------------------------------
#
@----------------------------------------
@Set ExpertAllowMixedRoiBinning to false
@----------------------------------------
WRITE_PROP;ExpertAllowMixedRoiBinning;BOOL;[false];;;;
#
@------------------------
@Init device 
@------------------------
CMD;Init;;;KO;;
#
@------------------------
@Wait (while state is UNKNOWN due to Init)
@------------------------
WAIT;state;STATE;8;DIFF;UNKNOWN;
#
@------------------------
@Wait (while state is INIT due to Init)
@------------------------
WAIT;state;STATE;0.2;DIFF;INIT;
#
@----------------------------------------
@Set Roi
@----------------------------------------
CMD;SetRoi;INT;256,256,42,42;;;
#
@------------------------------------------------------
@Check x - y - width - height attributes
@------------------------------------------------------
READ;roiX;INT;;EQUAL;256;
READ;roiY;INT;;EQUAL;256;
READ;roiWidth;INT;;EQUAL;42;
READ;roiHeight;INT;;EQUAL;42;
#
@--------------------------------------
@Sleep 2 sec (Execute a system command)
@--------------------------------------
EXEC;sleep;REAL;2;;;
#
@----------------------------------------
@Set binning
@----------------------------------------
CMD;SetBinning;INT;2,2;KO;;
#
@----------------------------------------
@Reset Roi
@----------------------------------------
CMD;ResetROI;;;;;
#
@----------------------------------------
@Reset binning
@----------------------------------------
CMD;ResetBinning;;;;;
#
@---------------------------------------------------------------------------------------
@---------------------------------------------------------------------------------------
@ PART V - Check that device init passes if binning and ROI is set with ExpertAllowMixedRoiBinning = false
@ with binning = 2x2 and ROI = 0,0,0,0
@---------------------------------------------------------------------------------------
@---------------------------------------------------------------------------------------
#
@----------------------------------------
@Write binning
@----------------------------------------
WRITE_PROP;MemorizedBinningH;INT;[2];;;;
WRITE_PROP;MemorizedBinningV;INT;[2];;;;
#
@----------------------------------------
@Write ROI
@----------------------------------------
WRITE_PROP;MemorizedRoi;STR_A;[0,0,0,0];;;;
#
@------------------------
@Init device 
@------------------------
CMD;Init;;;KO;;
#
@------------------------
@Wait (while state is UNKNOWN due to Init)
@------------------------
WAIT;state;STATE;8;DIFF;UNKNOWN;
#
@------------------------
@Wait (while state is INIT due to Init)
@------------------------
WAIT;state;STATE;0.2;DIFF;INIT;
#
@------------------------
@Wait state is STANDBY
@------------------------
READ;state;STATE;;EQUAL;STANDBY;
#
@---------------------------------------------------------------------------------------
@---------------------------------------------------------------------------------------
@ PART VI - Check that device init passes if binning and ROI is set with ExpertAllowMixedRoiBinning = false
@ with binning = 2x2 and ROI = -1,-1,-1,-1
@---------------------------------------------------------------------------------------
@---------------------------------------------------------------------------------------
#
@----------------------------------------
@Write binning
@----------------------------------------
WRITE_PROP;MemorizedBinningH;INT;[2];;;;
WRITE_PROP;MemorizedBinningV;INT;[2];;;;
#
@----------------------------------------
@Write ROI
@----------------------------------------
WRITE_PROP;MemorizedRoi;STR_A;[-1,-1,-1,-1];;;;
#
@------------------------
@Init device 
@------------------------
CMD;Init;;;KO;;
#
@------------------------
@Wait (while state is UNKNOWN due to Init)
@------------------------
WAIT;state;STATE;8;DIFF;UNKNOWN;
#
@------------------------
@Wait (while state is INIT due to Init)
@------------------------
WAIT;state;STATE;0.2;DIFF;INIT;
#
@------------------------
@Wait state is STANDBY
@------------------------
READ;state;STATE;;EQUAL;STANDBY;
#
@---------------------------------------------------------------------------------------
@---------------------------------------------------------------------------------------
@ PART VII - Check that device init passes if binning and ROI is set with ExpertAllowMixedRoiBinning = false
@ with binning = 2x2 and ROI = 0,0,2304,2304
@---------------------------------------------------------------------------------------
@---------------------------------------------------------------------------------------
#
@----------------------------------------
@Write binning
@----------------------------------------
WRITE_PROP;MemorizedBinningH;INT;[2];;;;
WRITE_PROP;MemorizedBinningV;INT;[2];;;;
#
@----------------------------------------
@Write ROI
@----------------------------------------
WRITE_PROP;MemorizedRoi;STR_A;[0,0,2304,2304];;;;
#
@------------------------
@Init device 
@------------------------
CMD;Init;;;KO;;
#
@------------------------
@Wait (while state is UNKNOWN due to Init)
@------------------------
WAIT;state;STATE;8;DIFF;UNKNOWN;
#
@------------------------
@Wait (while state is INIT due to Init)
@------------------------
WAIT;state;STATE;0.2;DIFF;INIT;
#
@------------------------
@Wait state is STANDBY
@------------------------
READ;state;STATE;;EQUAL;STANDBY;
#
@---------------------------------------------------------------------------------------
@---------------------------------------------------------------------------------------
@ PART VIII - Check that device init passes if binning and ROI is set with ExpertAllowMixedRoiBinning = false
@ with binning = 2x2 and ROI = 200,200,0,200
@---------------------------------------------------------------------------------------
@---------------------------------------------------------------------------------------
#
@----------------------------------------
@Write binning
@----------------------------------------
WRITE_PROP;MemorizedBinningH;INT;[2];;;;
WRITE_PROP;MemorizedBinningV;INT;[2];;;;
#
@----------------------------------------
@Write ROI
@----------------------------------------
WRITE_PROP;MemorizedRoi;STR_A;[200,200,0,200];;;;
#
@------------------------
@Init device 
@------------------------
CMD;Init;;;KO;;
#
@------------------------
@Wait (while state is UNKNOWN due to Init)
@------------------------
WAIT;state;STATE;8;DIFF;UNKNOWN;
#
@------------------------
@Wait (while state is INIT due to Init)
@------------------------
WAIT;state;STATE;0.2;DIFF;INIT;
#
@------------------------
@Wait state is STANDBY
@------------------------
READ;state;STATE;;EQUAL;STANDBY;
#
@---------------------------------------------------------------------------------------
@---------------------------------------------------------------------------------------
@ PART IX - Check that device init passes if binning and ROI is set with ExpertAllowMixedRoiBinning = false
@ with binning = 2x2 and ROI = 200,200,-1,200
@---------------------------------------------------------------------------------------
@---------------------------------------------------------------------------------------
#
@----------------------------------------
@Write binning
@----------------------------------------
WRITE_PROP;MemorizedBinningH;INT;[2];;;;
WRITE_PROP;MemorizedBinningV;INT;[2];;;;
#
@----------------------------------------
@Write ROI
@----------------------------------------
WRITE_PROP;MemorizedRoi;STR_A;[200,200,-1,200];;;;
#
@------------------------
@Init device 
@------------------------
CMD;Init;;;KO;;
#
@------------------------
@Wait (while state is UNKNOWN due to Init)
@------------------------
WAIT;state;STATE;8;DIFF;UNKNOWN;
#
@------------------------
@Wait (while state is INIT due to Init)
@------------------------
WAIT;state;STATE;0.2;DIFF;INIT;
#
@------------------------
@Wait state is STANDBY
@------------------------
READ;state;STATE;;EQUAL;STANDBY;
#
@---------------------------------------------------------------------------------------
@---------------------------------------------------------------------------------------
@ PART X - Check that device init fails if binning and ROI is set with ExpertAllowMixedRoiBinning = false
@ with binning = 2x2 and ROI = 200,0,200,200
@---------------------------------------------------------------------------------------
@---------------------------------------------------------------------------------------
#
@----------------------------------------
@Write binning
@----------------------------------------
WRITE_PROP;MemorizedBinningH;INT;[2];;;;
WRITE_PROP;MemorizedBinningV;INT;[2];;;;
#
@----------------------------------------
@Write ROI
@----------------------------------------
WRITE_PROP;MemorizedRoi;STR_A;[200,0,200,200];;;;
#
@------------------------
@Init device 
@------------------------
CMD;Init;;;KO;;
#
@------------------------
@Wait (while state is UNKNOWN due to Init)
@------------------------
WAIT;state;STATE;8;DIFF;UNKNOWN;
#
@------------------------
@Wait (while state is INIT due to Init)
@------------------------
WAIT;state;STATE;0.2;DIFF;INIT;
#
@------------------------
@Wait state is STANDBY
@------------------------
READ;state;STATE;;EQUAL;FAULT;
#
@---------------------------------------------------------------------------------------
@---------------------------------------------------------------------------------------
@ PART XI - Check that device init passes if binning and ROI is set with ExpertAllowMixedRoiBinning = false
@ with binning = 2x2 and ROI = 200,-1,200,200
@---------------------------------------------------------------------------------------
@---------------------------------------------------------------------------------------
#
@----------------------------------------
@Write binning
@----------------------------------------
WRITE_PROP;MemorizedBinningH;INT;[2];;;;
WRITE_PROP;MemorizedBinningV;INT;[2];;;;
#
@----------------------------------------
@Write ROI
@----------------------------------------
WRITE_PROP;MemorizedRoi;STR_A;[200,-1,200,200];;;;
#
@------------------------
@Init device 
@------------------------
CMD;Init;;;KO;;
#
@------------------------
@Wait (while state is UNKNOWN due to Init)
@------------------------
WAIT;state;STATE;8;DIFF;UNKNOWN;
#
@------------------------
@Wait (while state is INIT due to Init)
@------------------------
WAIT;state;STATE;0.2;DIFF;INIT;
#
@------------------------
@Wait state is STANDBY
@------------------------
READ;state;STATE;;EQUAL;STANDBY;
#